{"modules":[{"analyticsExecutionInterface":"restAPI","microAnalyticsDefinition":"select src, numDistinctDstIPs from (select src, count(*) as numDistinctDstIPs from (select trim(srcIP) as src, trim(dstIP) as dst from netflow where <timeStampBuilder> and trim(srcIP) not in (select * from IpFiltering) and trim(srcIP) not like '93.184.216.%' and trim(dstIP) not like '93.184.216.%' and  trim(srcIP)  like '93.184.217.%' group by srcIP, dstIP) as subQ1 group by src order by numDistinctDstIPs DESC) as subQ2 where numDistinctDstIPs >60 order by numDistinctDstIPs DESC","timestampData":{"hoursBackShift":0,"timestampType":"basic"},"description":"Device connecting to many distinct destination servers - subject to thresholds","microAnalyticsResults":{"systemId":1},"jarQueries":{},"isActive":true,"threatPhase":"Lateral Movement","priority":1,"outputAnalyticsResults":"microAnalytics0001_results","inputDataSource":"netflow","microAnalyticsType":"Abnormal Network Connections","microAnalyticsId":"microAnalytics0001","lastModified":"2016-09-06 13:10:00.067","microAnalyticsRepresentation":"SQL","analyticsEngine":"nikeAE"},{"analyticsExecutionInterface":"restAPI","microAnalyticsDefinition":"select src, numDistinctDstPorts from (select src, count(*) as numDistinctDstPorts from (select trim(srcIP) as src, trim(dstPort) as dPort from netflow where <timeStampBuilder> and trim(srcIP) not in (select * from IpFiltering) and trim(srcIP) not like '93.184.216.%' and trim(srcIP)  like '93.184.217.%' and trim(dstPort)<=1024 group by srcIP, dstPort) as subQ1 group by src order by numDistinctDstPorts DESC) as subQ2 where numDistinctDstPorts >=150 order by numDistinctDstPorts DESC","timestampData":{"hoursBackShift":0,"timestampType":"basic"},"description":"Device connecting to many distinct destination ports (across many destinations) - subject to thresholds","microAnalyticsResults":{"systemId":1},"jarQueries":{},"isActive":true,"threatPhase":"Lateral Movement","priority":2,"outputAnalyticsResults":"microAnalytics0002_results","inputDataSource":"netflow","microAnalyticsType":"Port Scanning","microAnalyticsId":"microAnalytics0002","lastModified":"2016-08-31 18:18:00.112","microAnalyticsRepresentation":"SQL","analyticsEngine":"nikeAE"},{"analyticsExecutionInterface":"restAPI","microAnalyticsDefinition":"select src, dst, numDistinctDstPorts from (select src, dst, count(*) as numDistinctDstPorts from  (select trim(srcIP) as src, trim(dstIP) as dst, trim(dstPort) as dPort from netflow where <timeStampBuilder> and   trim(srcIP) not in (select * from IpFiltering) and trim(srcIP) not like '93.184.216.%' and trim(dstIP) not like '93.184.216.%' and trim(srcIP)  like '93.184.217.%' and trim(dstPort)<=1024 group by srcIP, dstIP, dstPort) as subQ1 group by src,dst order by numDistinctDstPorts DESC) as subQ2 where numDistinctDstPorts >=150 order by numDistinctDstPorts DESC","timestampData":{"hoursBackShift":0,"timestampType":"basic"},"description":"Device connecting to many distinct ports per server - subject to thresholds","microAnalyticsResults":{"systemId":1},"jarQueries":{},"isActive":true,"threatPhase":"Lateral Movement","priority":3,"outputAnalyticsResults":"microAnalytics0003_results","inputDataSource":"netflow","microAnalyticsType":"Port Scanning","microAnalyticsId":"microAnalytics0003","lastModified":"2016-08-31 18:19:00.272","microAnalyticsRepresentation":"SQL","analyticsEngine":"nikeAE"},{"analyticsExecutionInterface":"restAPI","microAnalyticsDefinition":"select src, dst,  TrafficVolume from (select trim(srcIP) as src, trim(dstIP) as dst, sum(numBytes::INT) as TrafficVolume from netflow where <timeStampBuilder> and trim(srcIP) not in (select * from IpFiltering) and  trim(srcIP) not like '93.184.216.%' and trim(dstIP) not like '93.184.216.%' and trim(srcIP)  like '93.184.217.%' group by srcIP, dstIP ) as subQ1 where TrafficVolume >=10000000 order by TrafficVolume DESC","timestampData":{"hoursBackShift":0,"timestampType":"basic"},"description":"Device with high volume traffic per connected server - subject to thresholds","microAnalyticsResults":{"systemId":1},"jarQueries":{},"isActive":true,"threatPhase":"Exfiltration","priority":4,"outputAnalyticsResults":"microAnalytics0004_results","inputDataSource":"netflow","microAnalyticsType":"Abnormal Traffic Volume ","microAnalyticsId":"microAnalytics0004","lastModified":"2016-08-11 13:20:00.684","microAnalyticsRepresentation":"SQL","analyticsEngine":"nikeAE"},{"analyticsExecutionInterface":"restAPI","microAnalyticsDefinition":"select src, OverallTrafficVolume from (select src, sum(TrafficVolume) as OverallTrafficVolume from   (select trim(srcIP) as src, trim(dstIP) as dst, sum(numBytes::INT) as TrafficVolume from netflow where <timeStampBuilder> and trim(srcIP) not in (select * from IpFiltering) and trim(srcIP) not like '93.184.216.%' and trim(dstIP) not like '93.184.216.%' and trim(srcIP)  like '93.184.217.%' group by srcIP, dstIP ) as subQ1   group by src) as subQ2 where OverallTrafficVolume >=500000000 order by OverallTrafficVolume DESC","timestampData":{"hoursBackShift":0,"timestampType":"basic"},"description":"Device with hight volume traffic across many servers - subject to thresholds","microAnalyticsResults":{"systemId":1},"jarQueries":{},"isActive":true,"threatPhase":"Exfiltration","priority":5,"outputAnalyticsResults":"microAnalytics0005_results","inputDataSource":"netflow","microAnalyticsType":"Abnormal Traffic Volume ","microAnalyticsId":"microAnalytics0005","lastModified":"2016-08-05 14:18:00.275","microAnalyticsRepresentation":"SQL","analyticsEngine":"nikeAE"},{"analyticsExecutionInterface":"restAPI","microAnalyticsDefinition":"select uid, failureRate from  \n(select auidS ||' @ (' || hostTypeS || ') from ' ||host as uid, auidS, hostTypeS, host, countF/(countS+countF) as failureRate from    \n( select date(timestamp) AS Ds, pwdInfo.username as auidS, hostType as hostTypeS,  count(*) as countS from audit_events,\n   (select host, username, auid  from passwd where <timeStampBuilder> group by host, username, auid) as pwdInfo    \n   where type ='USER_AUTH' and success = 'yes' and <timeStampBuilder> and pwdInfo.host=audit_events.hostType \n   and audit_events.auid = pwdInfo.auid group by Ds, pwdInfo.username, hostType\n) as subQ1,\n( select date(timestamp) AS Df, auid as auidF, hostType as hostTypeF, host, count(*) as countF from audit_systemLogin \n  where  success ='no' and <timeStampBuilder> group by Df, auid, hostType, host ) as subQ2\nwhere Ds=Df and hostTypeS = hostTypeF and auidS = auidF) as subQFinal\nwhere failureRate >0.2","timestampData":{"hoursBackShift":0,"timestampType":"basic"},"description":"User having a too high ration of Login failures on a server","microAnalyticsResults":{"systemId":1,"userId":1},"jarQueries":{},"isActive":true,"threatPhase":"User Account Compromise","priority":6,"outputAnalyticsResults":"microAnalytics0006_results","inputDataSource":"SystemAuditLogs","microAnalyticsType":"Abnormal User Login Failures","jarURL":"null","microAnalyticsId":"microAnalytics0006","lastModified":"2016-11-10 18:20:00.104","microAnalyticsRepresentation":"SQL","analyticsEngine":"nikeAE"},{"analyticsExecutionInterface":"restAPI","microAnalyticsDefinition":"select src, numDistinctDstIPs from (select src, count(*) as numDistinctDstIPs from (select trim(srcIP) as src, trim(dstIP) as dst from netflow where <timeStampBuilder> and trim(srcIP) not in (select * from IpFiltering) and   trim(dstIP) not in (select * from IpFiltering) and trim(srcIP) not like '93.184.216.%' and trim(dstIP) not like '93.184.216.%' and  trim(srcIP)  like '93.184.217.%' group by srcIP, dstIP) as subQ1 group by src order by numDistinctDstIPs DESC) as subQ2 where numDistinctDstIPs >60 order by numDistinctDstIPs DESC","timestampData":{"hoursBackShift":0,"timestampType":"basic"},"description":"JAR Template","microAnalyticsResults":{"systemId":1},"jarQueries":{"query1":"SELECT * FROM nike.netflow where <timeStampBuilder>;","query2":"SELECT * FROM nike.netflow where <timeStampBuilder>;","query3":"SELECT * FROM nike.netflow where <timeStampBuilder>;"},"isActive":true,"threatPhase":"Lateral Movement","priority":10,"outputAnalyticsResults":"microAnalytics_java0001_results","inputDataSource":"netflow","microAnalyticsType":"Abnormal Network Connections","jarURL":"file:////home/nike/jetty8/webapps/modules/microAnalytics_java0001","microAnalyticsId":"microAnalytics_java0001","lastModified":"2016-09-07 10:58:00.558","microAnalyticsRepresentation":"JAR","analyticsEngine":"nikeAE"}]}
